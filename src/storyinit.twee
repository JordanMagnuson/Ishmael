:: StoryInit [script]


/*********************************************************************
 * HOWLER.JS LIBRARY (MINIFIED)
 *********************************************************************/

!function(){"use strict";var a=function(){this.init()};a.prototype={init:function(){var a=this||b;return a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.mobileAutoEnable=!0,a._setup(),a},volume:function(a){var c=this||b;if(a=parseFloat(a),c.ctx||j(),"undefined"!=typeof a&&a>=0&&a<=1){if(c._volume=a,c._muted)return c;c.usingWebAudio&&(c.masterGain.gain.value=a);for(var d=0;d<c._howls.length;d++)if(!c._howls[d]._webAudio)for(var e=c._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=c._howls[d]._soundById(e[f]);g&&g._node&&(g._node.volume=g._volume*a)}return c}return c._volume},mute:function(a){var c=this||b;c.ctx||j(),c._muted=a,c.usingWebAudio&&(c.masterGain.gain.value=a?0:c._volume);for(var d=0;d<c._howls.length;d++)if(!c._howls[d]._webAudio)for(var e=c._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=c._howls[d]._soundById(e[f]);g&&g._node&&(g._node.muted=!!a||g._muted)}return c},unload:function(){for(var a=this||b,c=a._howls.length-1;c>=0;c--)a._howls[c].unload();return a.usingWebAudio&&"undefined"!=typeof a.ctx.close&&(a.ctx.close(),a.ctx=null,j()),a},codecs:function(a){return(this||b)._codecs[a]},_setup:function(){var a=this||b;return a.state=a.ctx?a.ctx.state||"running":"running",a._autoSuspend(),a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||b,c="undefined"!=typeof Audio?new Audio:null;if(!c||"function"!=typeof c.canPlayType)return a;var d=c.canPlayType("audio/mpeg;").replace(/^no$/,""),e=a._navigator&&a._navigator.userAgent.match(/OPR\/([0-6].)/g),f=e&&parseInt(e[0].split("/")[1],10)<33;return a._codecs={mp3:!(f||!d&&!c.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!d,opus:!!c.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!c.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!c.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!c.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!c.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(c.canPlayType("audio/x-m4a;")||c.canPlayType("audio/m4a;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(c.canPlayType("audio/x-mp4;")||c.canPlayType("audio/mp4;")||c.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!c.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!c.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,"")},a},_enableMobileAudio:function(){var a=this||b,c=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(a._navigator&&a._navigator.userAgent),d=!!("ontouchend"in window||a._navigator&&a._navigator.maxTouchPoints>0||a._navigator&&a._navigator.msMaxTouchPoints>0);if(!a._mobileEnabled&&a.ctx&&(c||d)){a._mobileEnabled=!1,a._mobileUnloaded||44100===a.ctx.sampleRate||(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var e=function(){var b=a.ctx.createBufferSource();b.buffer=a._scratchBuffer,b.connect(a.ctx.destination),"undefined"==typeof b.start?b.noteOn(0):b.start(0),b.onended=function(){b.disconnect(0),a._mobileEnabled=!0,a.mobileAutoEnable=!1,document.removeEventListener("touchend",e,!0)}};return document.addEventListener("touchend",e,!0),a}},_autoSuspend:function(){var a=this;if(a.autoSuspend&&a.ctx&&"undefined"!=typeof a.ctx.suspend&&b.usingWebAudio){for(var c=0;c<a._howls.length;c++)if(a._howls[c]._webAudio)for(var d=0;d<a._howls[c]._sounds.length;d++)if(!a._howls[c]._sounds[d]._paused)return a;return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){a.autoSuspend&&(a._suspendTimer=null,a.state="suspending",a.ctx.suspend().then(function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())}))},3e4),a}},_autoResume:function(){var a=this;if(a.ctx&&"undefined"!=typeof a.ctx.resume&&b.usingWebAudio)return"running"===a.state&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):"suspended"===a.state?(a.state="resuming",a.ctx.resume().then(function(){a.state="running"}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):"suspending"===a.state&&(a._resumeAfterSuspend=!0),a}};var b=new a,c=function(a){var b=this;return a.src&&0!==a.src.length?void b.init(a):void console.error("An array of source files must be passed with any new Howl.")};c.prototype={init:function(a){var c=this;return b.ctx||j(),c._autoplay=a.autoplay||!1,c._format="string"!=typeof a.format?a.format:[a.format],c._html5=a.html5||!1,c._muted=a.mute||!1,c._loop=a.loop||!1,c._pool=a.pool||5,c._preload="boolean"!=typeof a.preload||a.preload,c._rate=a.rate||1,c._sprite=a.sprite||{},c._src="string"!=typeof a.src?a.src:[a.src],c._volume=void 0!==a.volume?a.volume:1,c._duration=0,c._state="unloaded",c._sounds=[],c._endTimers={},c._queue=[],c._onend=a.onend?[{fn:a.onend}]:[],c._onfade=a.onfade?[{fn:a.onfade}]:[],c._onload=a.onload?[{fn:a.onload}]:[],c._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],c._onpause=a.onpause?[{fn:a.onpause}]:[],c._onplay=a.onplay?[{fn:a.onplay}]:[],c._onstop=a.onstop?[{fn:a.onstop}]:[],c._onmute=a.onmute?[{fn:a.onmute}]:[],c._onvolume=a.onvolume?[{fn:a.onvolume}]:[],c._onrate=a.onrate?[{fn:a.onrate}]:[],c._onseek=a.onseek?[{fn:a.onseek}]:[],c._webAudio=b.usingWebAudio&&!c._html5,"undefined"!=typeof b.ctx&&b.ctx&&b.mobileAutoEnable&&b._enableMobileAudio(),b._howls.push(c),c._preload&&c.load(),c},load:function(){var a=this,c=null;if(b.noAudio)return void a._emit("loaderror",null,"No audio support.");"string"==typeof a._src&&(a._src=[a._src]);for(var e=0;e<a._src.length;e++){var g,h;if(a._format&&a._format[e])g=a._format[e];else{if(h=a._src[e],"string"!=typeof h){a._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}g=/^data:audio\/([^;,]+);/i.exec(h),g||(g=/\.([^.]+)$/.exec(h.split("?",1)[0])),g&&(g=g[1].toLowerCase())}if(b.codecs(g)){c=a._src[e];break}}return c?(a._src=c,a._state="loading","https:"===window.location.protocol&&"http:"===c.slice(0,5)&&(a._html5=!0,a._webAudio=!1),new d(a),a._webAudio&&f(a),a):void a._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(a,c){var d=this,e=null;if("number"==typeof a)e=a,a=null;else{if("string"==typeof a&&"loaded"===d._state&&!d._sprite[a])return null;if("undefined"==typeof a){a="__default";for(var f=0,g=0;g<d._sounds.length;g++)d._sounds[g]._paused&&!d._sounds[g]._ended&&(f++,e=d._sounds[g]._id);1===f?a=null:e=null}}var h=e?d._soundById(e):d._inactiveSound();if(!h)return null;if(e&&!a&&(a=h._sprite||"__default"),"loaded"!==d._state&&!d._sprite[a])return d._queue.push({event:"play",action:function(){d.play(d._soundById(h._id)?h._id:void 0)}}),h._id;if(e&&!h._paused)return c||setTimeout(function(){d._emit("play",h._id)},0),h._id;d._webAudio&&b._autoResume();var i=h._seek>0?h._seek:d._sprite[a][0]/1e3,j=(d._sprite[a][0]+d._sprite[a][1])/1e3-i,k=1e3*j/Math.abs(h._rate);h._paused=!1,h._ended=!1,h._sprite=a,h._seek=i,h._start=d._sprite[a][0]/1e3,h._stop=(d._sprite[a][0]+d._sprite[a][1])/1e3,h._loop=!(!h._loop&&!d._sprite[a][2]);var l=h._node;if(d._webAudio){var m=function(){d._refreshBuffer(h);var a=h._muted||d._muted?0:h._volume;l.gain.setValueAtTime(a,b.ctx.currentTime),h._playStart=b.ctx.currentTime,"undefined"==typeof l.bufferSource.start?h._loop?l.bufferSource.noteGrainOn(0,i,86400):l.bufferSource.noteGrainOn(0,i,j):h._loop?l.bufferSource.start(0,i,86400):l.bufferSource.start(0,i,j),k!==1/0&&(d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),k)),c||setTimeout(function(){d._emit("play",h._id)},0)};"loaded"===d._state?m():(d.once("load",m,h._id),d._clearTimer(h._id))}else{var n=function(){l.currentTime=i,l.muted=h._muted||d._muted||b._muted||l.muted,l.volume=h._volume*b.volume(),l.playbackRate=h._rate,setTimeout(function(){l.play(),k!==1/0&&(d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),k)),c||d._emit("play",h._id)},0)},o="loaded"===d._state&&(window&&window.ejecta||!l.readyState&&b._navigator.isCocoonJS);if(4===l.readyState||o)n();else{var p=function(){n(),l.removeEventListener(b._canPlayEvent,p,!1)};l.addEventListener(b._canPlayEvent,p,!1),d._clearTimer(h._id)}}return h._id},pause:function(a){var b=this;if("loaded"!==b._state)return b._queue.push({event:"pause",action:function(){b.pause(a)}}),b;for(var c=b._getSoundIds(a),d=0;d<c.length;d++){b._clearTimer(c[d]);var e=b._soundById(c[d]);if(e&&!e._paused){if(e._seek=b.seek(c[d]),e._rateSeek=0,e._paused=!0,b._stopFade(c[d]),e._node)if(b._webAudio){if(!e._node.bufferSource)return b;"undefined"==typeof e._node.bufferSource.stop?e._node.bufferSource.noteOff(0):e._node.bufferSource.stop(0),b._cleanBuffer(e._node)}else isNaN(e._node.duration)&&e._node.duration!==1/0||e._node.pause();arguments[1]||b._emit("pause",e._id)}}return b},stop:function(a,b){var c=this;if("loaded"!==c._state)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),c;for(var d=c._getSoundIds(a),e=0;e<d.length;e++){c._clearTimer(d[e]);var f=c._soundById(d[e]);if(f&&!f._paused&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,c._stopFade(d[e]),f._node))if(c._webAudio){if(!f._node.bufferSource)return c;"undefined"==typeof f._node.bufferSource.stop?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),c._cleanBuffer(f._node)}else isNaN(f._node.duration)&&f._node.duration!==1/0||(f._node.currentTime=f._start||0,f._node.pause());f&&!b&&c._emit("stop",f._id)}return c},mute:function(a,c){var d=this;if("loaded"!==d._state)return d._queue.push({event:"mute",action:function(){d.mute(a,c)}}),d;if("undefined"==typeof c){if("boolean"!=typeof a)return d._muted;d._muted=a}for(var e=d._getSoundIds(c),f=0;f<e.length;f++){var g=d._soundById(e[f]);g&&(g._muted=a,d._webAudio&&g._node?g._node.gain.setValueAtTime(a?0:g._volume,b.ctx.currentTime):g._node&&(g._node.muted=!!b._muted||a),d._emit("mute",g._id))}return d},volume:function(){var d,e,a=this,c=arguments;if(0===c.length)return a._volume;if(1===c.length){var f=a._getSoundIds(),g=f.indexOf(c[0]);g>=0?e=parseInt(c[0],10):d=parseFloat(c[0])}else c.length>=2&&(d=parseFloat(c[0]),e=parseInt(c[1],10));var h;if(!("undefined"!=typeof d&&d>=0&&d<=1))return h=e?a._soundById(e):a._sounds[0],h?h._volume:0;if("loaded"!==a._state)return a._queue.push({event:"volume",action:function(){a.volume.apply(a,c)}}),a;"undefined"==typeof e&&(a._volume=d),e=a._getSoundIds(e);for(var i=0;i<e.length;i++)h=a._soundById(e[i]),h&&(h._volume=d,c[2]||a._stopFade(e[i]),a._webAudio&&h._node&&!h._muted?h._node.gain.setValueAtTime(d,b.ctx.currentTime):h._node&&!h._muted&&(h._node.volume=d*b.volume()),a._emit("volume",h._id));return a},fade:function(a,c,d,e){var f=this,g=Math.abs(a-c),h=a>c?"out":"in",i=g/.01,j=d/i;if("loaded"!==f._state)return f._queue.push({event:"fade",action:function(){f.fade(a,c,d,e)}}),f;f.volume(a,e);for(var k=f._getSoundIds(e),l=0;l<k.length;l++){var m=f._soundById(k[l]);if(m){if(e||f._stopFade(k[l]),f._webAudio&&!m._muted){var n=b.ctx.currentTime,o=n+d/1e3;m._volume=a,m._node.gain.setValueAtTime(a,n),m._node.gain.linearRampToValueAtTime(c,o)}var p=a;m._interval=setInterval(function(a,b){p+="in"===h?.01:-.01,p=Math.max(0,p),p=Math.min(1,p),p=Math.round(100*p)/100,f._webAudio?("undefined"==typeof e&&(f._volume=p),b._volume=p):f.volume(p,a,!0),p===c&&(clearInterval(b._interval),b._interval=null,f.volume(p,a),f._emit("fade",a))}.bind(f,k[l],m),j)}}return f},_stopFade:function(a){var c=this,d=c._soundById(a);return d&&d._interval&&(c._webAudio&&d._node.gain.cancelScheduledValues(b.ctx.currentTime),clearInterval(d._interval),d._interval=null,c._emit("fade",a)),c},loop:function(){var c,d,e,a=this,b=arguments;if(0===b.length)return a._loop;if(1===b.length){if("boolean"!=typeof b[0])return e=a._soundById(parseInt(b[0],10)),!!e&&e._loop;c=b[0],a._loop=c}else 2===b.length&&(c=b[0],d=parseInt(b[1],10));for(var f=a._getSoundIds(d),g=0;g<f.length;g++)e=a._soundById(f[g]),e&&(e._loop=c,a._webAudio&&e._node&&e._node.bufferSource&&(e._node.bufferSource.loop=c));return a},rate:function(){var d,e,a=this,c=arguments;if(0===c.length)e=a._sounds[0]._id;else if(1===c.length){var f=a._getSoundIds(),g=f.indexOf(c[0]);g>=0?e=parseInt(c[0],10):d=parseFloat(c[0])}else 2===c.length&&(d=parseFloat(c[0]),e=parseInt(c[1],10));var h;if("number"!=typeof d)return h=a._soundById(e),h?h._rate:a._rate;if("loaded"!==a._state)return a._queue.push({event:"rate",action:function(){a.rate.apply(a,c)}}),a;"undefined"==typeof e&&(a._rate=d),e=a._getSoundIds(e);for(var i=0;i<e.length;i++)if(h=a._soundById(e[i])){h._rateSeek=a.seek(e[i]),h._playStart=a._webAudio?b.ctx.currentTime:h._playStart,h._rate=d,a._webAudio&&h._node&&h._node.bufferSource?h._node.bufferSource.playbackRate.value=d:h._node&&(h._node.playbackRate=d);var j=a.seek(e[i]),k=(a._sprite[h._sprite][0]+a._sprite[h._sprite][1])/1e3-j,l=1e3*k/Math.abs(h._rate);!a._endTimers[e[i]]&&h._paused||(a._clearTimer(e[i]),a._endTimers[e[i]]=setTimeout(a._ended.bind(a,h),l)),a._emit("rate",h._id)}return a},seek:function(){var d,e,a=this,c=arguments;if(0===c.length)e=a._sounds[0]._id;else if(1===c.length){var f=a._getSoundIds(),g=f.indexOf(c[0]);g>=0?e=parseInt(c[0],10):(e=a._sounds[0]._id,d=parseFloat(c[0]))}else 2===c.length&&(d=parseFloat(c[0]),e=parseInt(c[1],10));if("undefined"==typeof e)return a;if("loaded"!==a._state)return a._queue.push({event:"seek",action:function(){a.seek.apply(a,c)}}),a;var h=a._soundById(e);if(h){if(!("number"==typeof d&&d>=0)){if(a._webAudio){var j=a.playing(e)?b.ctx.currentTime-h._playStart:0,k=h._rateSeek?h._rateSeek-h._seek:0;return h._seek+(k+j*Math.abs(h._rate))}return h._node.currentTime}var i=a.playing(e);i&&a.pause(e,!0),h._seek=d,h._ended=!1,a._clearTimer(e),i&&a.play(e,!0),!a._webAudio&&h._node&&(h._node.currentTime=d),a._emit("seek",e)}return a},playing:function(a){var b=this;if("number"==typeof a){var c=b._soundById(a);return!!c&&!c._paused}for(var d=0;d<b._sounds.length;d++)if(!b._sounds[d]._paused)return!0;return!1},duration:function(a){var b=this,c=b._duration,d=b._soundById(a);return d&&(c=b._sprite[d._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var a=this,c=a._sounds,d=0;d<c.length;d++){c[d]._paused||(a.stop(c[d]._id),a._emit("end",c[d]._id)),a._webAudio||(c[d]._node.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",c[d]._node.removeEventListener("error",c[d]._errorFn,!1),c[d]._node.removeEventListener(b._canPlayEvent,c[d]._loadFn,!1)),delete c[d]._node,a._clearTimer(c[d]._id);var f=b._howls.indexOf(a);f>=0&&b._howls.splice(f,1)}var g=!0;for(d=0;d<b._howls.length;d++)if(b._howls[d]._src===a._src){g=!1;break}return e&&g&&delete e[a._src],a._state="unloaded",a._sounds=[],a=null,null},on:function(a,b,c,d){var e=this,f=e["_on"+a];return"function"==typeof b&&f.push(d?{id:c,fn:b,once:d}:{id:c,fn:b}),e},off:function(a,b,c){var d=this,e=d["_on"+a],f=0;if(b){for(f=0;f<e.length;f++)if(b===e[f].fn&&c===e[f].id){e.splice(f,1);break}}else if(a)d["_on"+a]=[];else{var g=Object.keys(d);for(f=0;f<g.length;f++)0===g[f].indexOf("_on")&&Array.isArray(d[g[f]])&&(d[g[f]]=[])}return d},once:function(a,b,c){var d=this;return d.on(a,b,c,1),d},_emit:function(a,b,c){for(var d=this,e=d["_on"+a],f=e.length-1;f>=0;f--)e[f].id&&e[f].id!==b&&"load"!==a||(setTimeout(function(a){a.call(this,b,c)}.bind(d,e[f].fn),0),e[f].once&&d.off(a,e[f].fn,e[f].id));return d},_loadQueue:function(){var a=this;if(a._queue.length>0){var b=a._queue[0];a.once(b.event,function(){a._queue.shift(),a._loadQueue()}),b.action()}return a},_ended:function(a){var c=this,d=a._sprite,e=!(!a._loop&&!c._sprite[d][2]);if(c._emit("end",a._id),!c._webAudio&&e&&c.stop(a._id,!0).play(a._id),c._webAudio&&e){c._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=b.ctx.currentTime;var f=1e3*(a._stop-a._start)/Math.abs(a._rate);c._endTimers[a._id]=setTimeout(c._ended.bind(c,a),f)}return c._webAudio&&!e&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,c._clearTimer(a._id),c._cleanBuffer(a._node),b._autoSuspend()),c._webAudio||e||c.stop(a._id),c},_clearTimer:function(a){var b=this;return b._endTimers[a]&&(clearTimeout(b._endTimers[a]),delete b._endTimers[a]),b},_soundById:function(a){for(var b=this,c=0;c<b._sounds.length;c++)if(a===b._sounds[c]._id)return b._sounds[c];return null},_inactiveSound:function(){var a=this;a._drain();for(var b=0;b<a._sounds.length;b++)if(a._sounds[b]._ended)return a._sounds[b].reset();return new d(a)},_drain:function(){var a=this,b=a._pool,c=0,d=0;if(!(a._sounds.length<b)){for(d=0;d<a._sounds.length;d++)a._sounds[d]._ended&&c++;for(d=a._sounds.length-1;d>=0;d--){if(c<=b)return;a._sounds[d]._ended&&(a._webAudio&&a._sounds[d]._node&&a._sounds[d]._node.disconnect(0),a._sounds.splice(d,1),c--)}}},_getSoundIds:function(a){var b=this;if("undefined"==typeof a){for(var c=[],d=0;d<b._sounds.length;d++)c.push(b._sounds[d]._id);return c}return[a]},_refreshBuffer:function(a){var c=this;return a._node.bufferSource=b.ctx.createBufferSource(),a._node.bufferSource.buffer=e[c._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop),a._node.bufferSource.playbackRate.value=a._rate,c},_cleanBuffer:function(a){var b=this;if(b._scratchBuffer){a.bufferSource.onended=null,a.bufferSource.disconnect(0);try{a.bufferSource.buffer=b._scratchBuffer}catch(a){}}return a.bufferSource=null,b}};var d=function(a){this._parent=a,this.init()};d.prototype={init:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._muted=b._muted,a._rate=b._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=Math.round(Date.now()*Math.random()),b._sounds.push(a),a.create(),a},create:function(){var a=this,c=a._parent,d=b._muted||a._muted||a._parent._muted?0:a._volume;return c._webAudio?(a._node="undefined"==typeof b.ctx.createGain?b.ctx.createGainNode():b.ctx.createGain(),a._node.gain.setValueAtTime(d,b.ctx.currentTime),a._node.paused=!0,a._node.connect(b.masterGain)):(a._node=new Audio,a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(b._canPlayEvent,a._loadFn,!1),a._node.src=c._src,a._node.preload="auto",a._node.volume=d*b.volume(),a._node.load()),a},reset:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._muted=b._muted,a._rate=b._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=Math.round(Date.now()*Math.random()),a},_errorListener:function(){var a=this;a._node.error&&4===a._node.error.code&&(b.noAudio=!0),a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorListener,!1)},_loadListener:function(){var a=this,c=a._parent;c._duration=Math.ceil(10*a._node.duration)/10,0===Object.keys(c._sprite).length&&(c._sprite={__default:[0,1e3*c._duration]}),"loaded"!==c._state&&(c._state="loaded",c._emit("load"),c._loadQueue()),c._autoplay&&c.play(),a._node.removeEventListener(b._canPlayEvent,a._loadFn,!1)}};var e={},f=function(a){var b=a._src;if(e[b])return a._duration=e[b].duration,void i(a);if(/^data:[^;]+;base64,/.test(b)){for(var c=atob(b.split(",")[1]),d=new Uint8Array(c.length),f=0;f<c.length;++f)d[f]=c.charCodeAt(f);h(d.buffer,a)}else{var j=new XMLHttpRequest;j.open("GET",b,!0),j.responseType="arraybuffer",j.onload=function(){var b=(j.status+"")[0];return"0"!==b&&"2"!==b&&"3"!==b?void a._emit("loaderror",null,"Failed loading audio file with status: "+j.status+"."):void h(j.response,a)},j.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete e[b],a.load())},g(j)}},g=function(a){try{a.send()}catch(b){a.onerror()}},h=function(a,c){b.ctx.decodeAudioData(a,function(a){a&&c._sounds.length>0&&(e[c._src]=a,i(c,a))},function(){c._emit("loaderror",null,"Decoding audio data failed.")})},i=function(a,b){b&&!a._duration&&(a._duration=b.duration),0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1e3*a._duration]}),"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue()),a._autoplay&&a.play()},j=function(){b.noAudio=!1;try{"undefined"!=typeof AudioContext?b.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?b.ctx=new webkitAudioContext:b.usingWebAudio=!1}catch(a){b.usingWebAudio=!1}if(!b.usingWebAudio)if("undefined"!=typeof Audio)try{var a=new Audio;"undefined"==typeof a.oncanplaythrough&&(b._canPlayEvent="canplay")}catch(a){b.noAudio=!0}else b.noAudio=!0;try{var a=new Audio;a.muted&&(b.noAudio=!0)}catch(a){}var c=/iP(hone|od|ad)/.test(b._navigator&&b._navigator.platform),d=b._navigator&&b._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),e=d?parseInt(d[1],10):null;if(c&&e&&e<9){var f=/safari/.test(b._navigator&&b._navigator.userAgent.toLowerCase());(b._navigator&&b._navigator.standalone&&!f||b._navigator&&!b._navigator.standalone&&!f)&&(b.usingWebAudio=!1)}b.usingWebAudio&&(b.masterGain="undefined"==typeof b.ctx.createGain?b.ctx.createGainNode():b.ctx.createGain(),b.masterGain.gain.value=1,b.masterGain.connect(b.ctx.destination)),b._setup()};"function"==typeof define&&define.amd&&define([],function(){return{Howler:b,Howl:c}}),"undefined"!=typeof exports&&(exports.Howler=b,exports.Howl=c),"undefined"!=typeof window?(window.HowlerGlobal=a,window.Howler=b,window.Howl=c,window.Sound=d):"undefined"!=typeof global&&(global.HowlerGlobal=a,global.Howler=b,global.Howl=c,global.Sound=d)}(),function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(a){var b=this;if(!b.ctx||!b.ctx.listener)return b;for(var c=b._howls.length-1;c>=0;c--)b._howls[c].stereo(a);return b},HowlerGlobal.prototype.pos=function(a,b,c){var d=this;return d.ctx&&d.ctx.listener?(b="number"!=typeof b?d._pos[1]:b,c="number"!=typeof c?d._pos[2]:c,"number"!=typeof a?d._pos:(d._pos=[a,b,c],d.ctx.listener.setPosition(d._pos[0],d._pos[1],d._pos[2]),d)):d},HowlerGlobal.prototype.orientation=function(a,b,c,d,e,f){var g=this;if(!g.ctx||!g.ctx.listener)return g;var h=g._orientation;return b="number"!=typeof b?h[1]:b,c="number"!=typeof c?h[2]:c,d="number"!=typeof d?h[3]:d,e="number"!=typeof e?h[4]:e,f="number"!=typeof f?h[5]:f,"number"!=typeof a?h:(g._orientation=[a,b,c,d,e,f],g.ctx.listener.setOrientation(a,b,c,d,e,f),g)},Howl.prototype.init=function(a){return function(b){var c=this;return c._orientation=b.orientation||[1,0,0],c._stereo=b.stereo||null,c._pos=b.pos||null,c._pannerAttr={coneInnerAngle:"undefined"!=typeof b.coneInnerAngle?b.coneInnerAngle:360,coneOuterAngle:"undefined"!=typeof b.coneOuterAngle?b.coneOuterAngle:360,coneOuterGain:"undefined"!=typeof b.coneOuterGain?b.coneOuterGain:0,distanceModel:"undefined"!=typeof b.distanceModel?b.distanceModel:"inverse",maxDistance:"undefined"!=typeof b.maxDistance?b.maxDistance:1e4,panningModel:"undefined"!=typeof b.panningModel?b.panningModel:"HRTF",refDistance:"undefined"!=typeof b.refDistance?b.refDistance:1,rolloffFactor:"undefined"!=typeof b.rolloffFactor?b.rolloffFactor:1},c._onstereo=b.onstereo?[{fn:b.onstereo}]:[],c._onpos=b.onpos?[{fn:b.onpos}]:[],c._onorientation=b.onorientation?[{fn:b.onorientation}]:[],a.call(this,b)}}(Howl.prototype.init),Howl.prototype.stereo=function(b,c){var d=this;if(!d._webAudio)return d;if("loaded"!==d._state)return d._queue.push({event:"stereo",action:function(){d.stereo(b,c)}}),d;var e="undefined"==typeof Howler.ctx.createStereoPanner?"spatial":"stereo";if("undefined"==typeof c){if("number"!=typeof b)return d._stereo;d._stereo=b,d._pos=[b,0,0]}for(var f=d._getSoundIds(c),g=0;g<f.length;g++){var h=d._soundById(f[g]);if(h){if("number"!=typeof b)return h._stereo;h._stereo=b,h._pos=[b,0,0],h._node&&(h._pannerAttr.panningModel="equalpower",h._panner&&h._panner.pan||a(h,e),"spatial"===e?h._panner.setPosition(b,0,0):h._panner.pan.value=b),d._emit("stereo",h._id)}}return d},Howl.prototype.pos=function(b,c,d,e){var f=this;if(!f._webAudio)return f;if("loaded"!==f._state)return f._queue.push({event:"pos",action:function(){f.pos(b,c,d,e)}}),f;if(c="number"!=typeof c?0:c,d="number"!=typeof d?-.5:d,"undefined"==typeof e){if("number"!=typeof b)return f._pos;f._pos=[b,c,d]}for(var g=f._getSoundIds(e),h=0;h<g.length;h++){var i=f._soundById(g[h]);if(i){if("number"!=typeof b)return i._pos;i._pos=[b,c,d],i._node&&(i._panner&&!i._panner.pan||a(i,"spatial"),i._panner.setPosition(b,c,d)),f._emit("pos",i._id)}}return f},Howl.prototype.orientation=function(b,c,d,e){var f=this;if(!f._webAudio)return f;if("loaded"!==f._state)return f._queue.push({event:"orientation",action:function(){f.orientation(b,c,d,e)}}),f;if(c="number"!=typeof c?f._orientation[1]:c,d="number"!=typeof d?f._orientation[2]:d,"undefined"==typeof e){if("number"!=typeof b)return f._orientation;f._orientation=[b,c,d]}for(var g=f._getSoundIds(e),h=0;h<g.length;h++){var i=f._soundById(g[h]);if(i){if("number"!=typeof b)return i._orientation;i._orientation=[b,c,d],i._node&&(i._panner||(i._pos||(i._pos=f._pos||[0,0,-.5]),a(i,"spatial")),i._panner.setOrientation(b,c,d)),f._emit("orientation",i._id)}}return f},Howl.prototype.pannerAttr=function(){var d,e,f,b=this,c=arguments;if(!b._webAudio)return b;if(0===c.length)return b._pannerAttr;if(1===c.length){if("object"!=typeof c[0])return f=b._soundById(parseInt(c[0],10)),f?f._pannerAttr:b._pannerAttr;d=c[0],"undefined"==typeof e&&(b._pannerAttr={coneInnerAngle:"undefined"!=typeof d.coneInnerAngle?d.coneInnerAngle:b._coneInnerAngle,coneOuterAngle:"undefined"!=typeof d.coneOuterAngle?d.coneOuterAngle:b._coneOuterAngle,coneOuterGain:"undefined"!=typeof d.coneOuterGain?d.coneOuterGain:b._coneOuterGain,distanceModel:"undefined"!=typeof d.distanceModel?d.distanceModel:b._distanceModel,maxDistance:"undefined"!=typeof d.maxDistance?d.maxDistance:b._maxDistance,panningModel:"undefined"!=typeof d.panningModel?d.panningModel:b._panningModel,refDistance:"undefined"!=typeof d.refDistance?d.refDistance:b._refDistance,rolloffFactor:"undefined"!=typeof d.rolloffFactor?d.rolloffFactor:b._rolloffFactor})}else 2===c.length&&(d=c[0],e=parseInt(c[1],10));for(var g=b._getSoundIds(e),h=0;h<g.length;h++)if(f=b._soundById(g[h])){var i=f._pannerAttr;i={coneInnerAngle:"undefined"!=typeof d.coneInnerAngle?d.coneInnerAngle:i.coneInnerAngle,coneOuterAngle:"undefined"!=typeof d.coneOuterAngle?d.coneOuterAngle:i.coneOuterAngle,coneOuterGain:"undefined"!=typeof d.coneOuterGain?d.coneOuterGain:i.coneOuterGain,distanceModel:"undefined"!=typeof d.distanceModel?d.distanceModel:i.distanceModel,maxDistance:"undefined"!=typeof d.maxDistance?d.maxDistance:i.maxDistance,panningModel:"undefined"!=typeof d.panningModel?d.panningModel:i.panningModel,refDistance:"undefined"!=typeof d.refDistance?d.refDistance:i.refDistance,rolloffFactor:"undefined"!=typeof d.rolloffFactor?d.rolloffFactor:i.rolloffFactor};var j=f._panner;j?(j.coneInnerAngle=i.coneInnerAngle,j.coneOuterAngle=i.coneOuterAngle,j.coneOuterGain=i.coneOuterGain,j.distanceModel=i.distanceModel,j.maxDistance=i.maxDistance,j.panningModel=i.panningModel,j.refDistance=i.refDistance,j.rolloffFactor=i.rolloffFactor):(f._pos||(f._pos=b._pos||[0,0,-.5]),a(f,"spatial"))}return b},Sound.prototype.init=function(a){return function(){var b=this,c=b._parent;b._orientation=c._orientation,b._stereo=c._stereo,b._pos=c._pos,b._pannerAttr=c._pannerAttr,a.call(this),b._stereo?c.stereo(b._stereo):b._pos&&c.pos(b._pos[0],b._pos[1],b._pos[2],b._id)}}(Sound.prototype.init),Sound.prototype.reset=function(a){return function(){var b=this,c=b._parent;return b._orientation=c._orientation,b._pos=c._pos,b._pannerAttr=c._pannerAttr,a.call(this)}}(Sound.prototype.reset);var a=function(a,b){b=b||"spatial","spatial"===b?(a._panner=Howler.ctx.createPanner(),a._panner.coneInnerAngle=a._pannerAttr.coneInnerAngle,a._panner.coneOuterAngle=a._pannerAttr.coneOuterAngle,a._panner.coneOuterGain=a._pannerAttr.coneOuterGain,a._panner.distanceModel=a._pannerAttr.distanceModel,a._panner.maxDistance=a._pannerAttr.maxDistance,a._panner.panningModel=a._pannerAttr.panningModel,a._panner.refDistance=a._pannerAttr.refDistance,a._panner.rolloffFactor=a._pannerAttr.rolloffFactor,a._panner.setPosition(a._pos[0],a._pos[1],a._pos[2]),a._panner.setOrientation(a._orientation[0],a._orientation[1],a._orientation[2])):(a._panner=Howler.ctx.createStereoPanner(),a._panner.pan.value=a._stereo),a._panner.connect(a._node),a._paused||a._parent.pause(a._id,!0).play(a._id)}}();

/*********************************************************************
 * INITIALIZE VARIABLES
 *********************************************************************/
window.upDownCount = 0;

/*********************************************************************
 * DOM MODIFICATIONS
 *********************************************************************/

// Add a div beneath body that we will use to handle our puppets.
$('body').prepend('<div id="puppetsheet"></div>');
$('body').prepend('<div id="puppetbg"></div>');

// Add the puppets.
$('#puppetbg').append('<img class="puppet" id="puppet-boy" src="assets/puppet_boy.png" />');
$('#puppetbg').append('<img class="puppet" id="puppet-father" src="assets/puppet_father.png" />');

$("#puppetsheet").hide();
$(".puppet").hide();

$('body').prepend('<div class="background-image" id="blood-overlay"></div>');


/*********************************************************************
 * LOAD SOUNDS
 *********************************************************************/
window.sndCelebration = new Howl({
	src: ['assets/sounds/209982__yuval__distant-turkish-wedding.mp3'],
	loop: true,
	volume: 0.3
});

window.sndHollering = new Howl({
	src: ['assets/sounds/17343__audiblepie-com__welcome-scream.mp3'],
	loop: true,
	volume: 0.1
});

window.sndShouting = new Howl({
	src: ['assets/sounds/101871__dickblox__crowd-shouting.mp3'],
	loop: true,
	volume: 1
});

window.sndMachinegunLoop = new Howl({
	src: ['assets/sounds/101961__cgeffex__heavy-machine-gun.mp3'],
	loop: true,
	volume: 0.5
});

window.sndBreathing = new Howl({
	src: ['assets/sounds/54776__bevangoldswain__heavy-breathing-off-mic-loop.mp3'],
	loop: true,
	volume: 0.5
});

window.sndHeartbeat = new Howl({
	src: ['assets/sounds/250845__niedec__heartbeat.mp3'],
	loop: true,
	volume: 0.5
});

window.sndWar = new Howl({
	src: ['assets/sounds/96533__omar-alvarado__modern-day-war_01.mp3'],
	loop: false,
	volume: 1
});


/*********************************************************************
 * PRELOAD IMAGES
 *********************************************************************/
window.violentImageArray = Array(
	"14107469954_b84973bf28_o.jpg",
	"2190176602_9c4e70b78b.jpg",
	"3298081311_d75e5d5c1f_o.jpg",
	"Another_injury_caused_by_the_bombing_of_Israeli_Air_Forces_over_Gaza_Strip,_reached_the_hospital_unconscious.jpg",
	"Chemical_burns_follwong_Israeli_bombings1.jpg",
	"Fatally_wounded_Israeli_school_boy.jpg",
	"Flickr_-_Israel_Defense_Forces_-_Bil-in_Riot,_Jan_2011_6.jpg",
	"Gazaday14.jpg",
	"n721725932_1613535_8023.jpg",
	"Near_Beit_El_-_north_of_Ramallah_10.10.2015_10.jpg",
	"Near_Beit_El_-_north_of_Ramallah_10.10.jpg",
	"Palestinian_Demonstrator_picks_Tear_gas_grenade_to_throw_back_Kafr_Qaddum_August_2014_2.jpg",
	"Palestinian_militant_with_rifle.jpg"
);	
for(var i = violentImageArray.length - 1; i >= 0; i--){
	var preloadImage = violentImageArray[i];
	$('body').prepend('<div class="preload-image" id="preload-image-' + i + '" style="background-image: url(assets/photos/violence/' + preloadImage + '"></div>');
}

window.facesImageArray = Array(
	"3202880684_763846e8f4_o.jpg",
	"3286208380_176e6f164f_o.jpg",
	"3286231988_ae66a85935_o.jpg",
	"3286249224_6e31fba579_o.jpg",
	"3286256664_0fac09c4e0_o.jpg",
	"3286467903_1cf6aba0b7_o.jpg",
	"4742026797_dbfb4c57e0_o.jpg",
	"4991232884_ac841ee310_o.jpg",
	"5513283076_05ec4fc98b_o.jpg",
	"Shaymaa_al-Masri_five_years_old_at_a-Shifaa_Hospital_Gaza.jpg"
);
for(var i = facesImageArray.length - 1; i >= 0; i--){
	var preloadImage = facesImageArray[i];
	$('body').prepend('<div class="preload-image" id="preload-image-' + i + '" style="background-image: url(assets/photos/faces/' + preloadImage + '"></div>');
}

/*********************************************************************
 * UTILITY FUNCTIONS
 *********************************************************************/
window.holdGunUp = function(length) {		
	// Move the whole passage up (use % from top, so that movement is relative to window height)
	$('.passage').animate({ top : "-=5%" }, 500, 'swing');
	$('#gun').animate({ top : "-=12%" }, 500, 'swing');

	// Initialize image array.
	if (typeof violentImageArrayCopy == 'undefined' || violentImageArrayCopy.length < 1) {
		console.log('reinitialize array');
		window.violentImageArrayCopy = violentImageArray.slice(0);
	}
	console.log(violentImageArrayCopy);

	// Get a random image from the array.
	var randomImage = violentImageArrayCopy.splice(Math.floor(Math.random()*violentImageArrayCopy.length), 1);
	console.log(randomImage);

	// Move any existing background images down on the z-index, so that the new one will be on top.
	$('.background-image').css('z-index', 19);
	
	// Prepend the image to the body with a random div id so that we can access it / fade it out. 
	var randomID = idGenerator();
	$('body').prepend('<div class="background-image" id="' + randomID + '" style="background-image: url(assets/photos/violence/' + randomImage + '"></div>');
	$('#' + randomID).fadeOut(5000, function() { $(this).remove(); });

	// Increase blood overlay.
	var bloodOverlayOpacity = $('#blood-overlay').css('opacity');
	bloodOverlayOpacity = Number(bloodOverlayOpacity)
	if (bloodOverlayOpacity < 1) {
		bloodOverlayOpacity = bloodOverlayOpacity + 0.1;
		console.log('bloodOverlayOpacity: ' + bloodOverlayOpacity);
		$('#blood-overlay').css('opacity', bloodOverlayOpacity);
	}

	// Increase breathing and heartbeat volume.
    var currentVol = sndBreathing.volume();
    currentVol += .1;
    if (currentVol <= 1)
    	sndBreathing.volume(currentVol);
    var currentVol = sndHeartbeat.volume();
    currentVol += .1;
    if (currentVol <= 1)
    	sndHeartbeat.volume(currentVol);		

	// War sounds.
	//sndWar.play();

	// Track where the gun is.
	upDownCount += 1;
	if (upDownCount >= 20) {
		State.play("Put it down");
	}	        
};

window.putGunDown = function(length) {		
	// Move the whole passage down (use % from top, so that movement is relative to window height)
	$('.passage').animate({ top : "+=5%" }, 500, 'swing');
	$('#gun').animate({ top : "+=12%" }, 500, 'swing');	

	// Initialize image array.
	if (typeof facesImageArrayCopy == 'undefined' || facesImageArrayCopy.length < 1) {
		console.log('reinitialize array');
		window.facesImageArrayCopy = facesImageArray.slice(0);
	}
	console.log(facesImageArrayCopy);

	// Get a random image from the array.
	var randomImage = facesImageArrayCopy.splice(Math.floor(Math.random()*facesImageArrayCopy.length), 1);
	console.log(randomImage);

	// Move any existing background images down on the z-index, so that the new one will be on top.
	$('.background-image').css('z-index', 19);
	
	// Prepend the image to the body with a random div id so that we can access it / fade it out. 
	var randomID = idGenerator();
	$('body').prepend('<div class="background-image" id="' + randomID + '" style="background-image: url(assets/photos/faces/' + randomImage + '"></div>');
	$('#' + randomID).fadeOut(5000, function() { $(this).remove(); });

	// Decrease breathing and heartbeat volume.
    var currentVol = sndBreathing.volume();
    currentVol -= .1;
    if (currentVol >= 0.1)
    	sndBreathing.volume(currentVol);
    var currentVol = sndHeartbeat.volume();
    currentVol -= .1;
    if (currentVol >= 0.1)
    	sndHeartbeat.volume(currentVol);	

	// Stop war sounds.
	sndWar.stop();	

	// Track where the gun is.
	upDownCount -= 1;
	if (upDownCount <= -20) {
		State.play("Put it down");
	}	 	
};

/*
 * Generate a random ID (for a div)
 */
window.idGenerator = function() {
    var S4 = function() {
       return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
    };
    return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
}

/**
 * Returns a random integer between min (inclusive) and max (inclusive)
 * Using Math.round() will give you a non-uniform distribution!
 */
window.getRandomInt = function(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}